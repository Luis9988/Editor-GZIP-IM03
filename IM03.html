<!DOCTYPE html>
<html>
<head>
    <title>Buscar Secuencias Hexadecimales</title>
</head>
<body>
    <input type="file" id="fileInput">
    <button onclick="buscarSecuencias()">Buscar Secuencias</button>
    <button onclick="copiarResultado()">Copiar Resultado</button>
    <button onclick="enumerarResultado()">Enumerar Resultado</button>
    <br><br>
    <textarea id="resultadoTextarea" style="width: 100%; height: 200px;"></textarea>

    <script>
        function buscarSecuencias() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];

    if (!file) {
        alert('Por favor, selecciona un archivo.');
        return;
    }

    const reader = new FileReader();

    reader.onload = function(event) {
        const arrayBuffer = event.target.result;
        const bytes = new Uint8Array(arrayBuffer);

        const sequences = {
            'GZIP': [0x47, 0x5A, 0x49, 0x50],
            'SPLT': [0x53, 0x50, 0x4C, 0x54],
            'IM03': [0x49, 0x4D, 0x30, 0x33],
            'TTT2': [0x54, 0x54, 0x54, 0x32]
        };

        let result = '';
        for (const sequenceName in sequences) {
            const sequence = sequences[sequenceName];
            const positions = findAllSequencePositions(bytes, sequence);
            if (positions.length > 0) {
                for (const pos of positions) {
                    const start = pos.toString(16).toUpperCase().padStart(8, '0');
                    const end = findNextSequenceIndex(bytes.slice(pos + sequence.length), sequences['GZIP'], sequences['SPLT'], sequences['IM03'], sequences['TTT2']) + pos + sequence.length;
                    const length = end - pos;
                    result += `${start} ${length.toString(16).toUpperCase().padStart(8, '0')}\n`;
                }
            }
        }

        if (result !== '') {
            document.getElementById('resultadoTextarea').value = result;
        } else {
            document.getElementById('resultadoTextarea').value = 'Secuencias no encontradas en el archivo.';
        }
    };

    reader.readAsArrayBuffer(file);
}

function findAllSequencePositions(bytes, sequence) {
    const positions = [];
    for (let i = 0; i < bytes.length - sequence.length + 1; i++) {
        if (bytes.slice(i, i + sequence.length).every((value, index) => value === sequence[index])) {
            positions.push(i);
        }
    }
    return positions;
}

function findNextSequenceIndex(bytes, gzipSequence, spltSequence, im03Sequence, ttt2Sequence) {
    let i = 0;
    while (i < bytes.length) {
        if (compareBytes(bytes.slice(i, i + gzipSequence.length), gzipSequence)) {
            return i;
        }
        if (compareBytes(bytes.slice(i, i + spltSequence.length), spltSequence)) {
            return i;
        }
        if (compareBytes(bytes.slice(i, i + im03Sequence.length), im03Sequence)) {
            return i;
        }
        if (compareBytes(bytes.slice(i, i + ttt2Sequence.length), ttt2Sequence)) {
            return i;
        }
        i++;
    }
    return bytes.length;
}

function compareBytes(bytes1, bytes2) {
    if (bytes1.length !== bytes2.length) {
        return false;
    }
    for (let i = 0; i < bytes1.length; i++) {
        if (bytes1[i] !== bytes2[i]) {
            return false;
        }
    }
    return true;
}


        function copiarResultado() {
            const resultadoTextarea = document.getElementById('resultadoTextarea');
            resultadoTextarea.select();
            document.execCommand('copy');
            alert('Resultado copiado al portapapeles.');
        }

        function enumerarResultado() {
    const resultadoTextarea = document.getElementById('resultadoTextarea');
    const lines = resultadoTextarea.value.split('\n');
    let numberedResult = '';
    for (let i = 0; i < lines.length; i++) {
        numberedResult += `${i.toString(16).toUpperCase().padStart(2, '0')} ${lines[i]}\n`;
    }
    resultadoTextarea.value = numberedResult.trim();
}

    </script>
</body>
</html>
